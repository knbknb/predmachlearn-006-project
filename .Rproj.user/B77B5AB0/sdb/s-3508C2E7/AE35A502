{
    "contents" : "## Report: Number of fatalities and economic damage caused by extreme weather events increased considerably since 1993, US government database indicates. ##\n\n\n#### Synopsis ###\n\nStatistical analysis of a comprehensive weather database, compiled by US authority NOAA over 60 years, reveals that the number of fatalities and economic damage caused by extreme weather events are increasing.\nThe database actually consists of two methodologically distinct subsets: those data collected from 1950s to 1993, and those data from 1993 to 2011. \nThe pre-1993 was classified into three distinct extreme-weather events only ( \"tornado\"   \"thunderstorm wind\" \"hail\"), with tornado causing the greatest fatalities and largest damage.\nIn contrast the after-1993 data (and including 1993) have a fine granularity of 985 distinct event types, of which both wind-related events, and extreme heat/drought realted event types equally contribute to economic damage and number of fatalities.  \nIn any case, whereas the order of magnitude of number of fatalities remains relatively constant, the amount of damage done by extreme weather events has risen dramatically (6-fold) over the two periods, since 1997 exceeding 5 billion dollars each year, and 10 billion dollars 3 times in the past 20 years. \n\n### Data Processing ###\n\n#### Data acquisition ####\nThe weather database was a copy acquired from the web.  \n**Source  URL:** [https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2)\n\n\n**Date accessed:** July 23rd 2014\n\n**Description:** U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database, containing 1.23 million records. This database tracks characteristics of major storms and weather events in the United States from the 1950s to 2011, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.\n\nThere is also very specific documentation of the database available. These links describe how some of the variables are constructed/defined.  \n\n - [National Weather Service Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)\n \n - [National Climatic Data Center Storm Events FAQ](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf)\n\nIn the earlier years of the database there are generally fewer events recorded, most likely due to a lack of good records. More recent years should be considered more complete.\n\n##### Software used ######\nAll calcuations were performed with `r R.version$version.string`. \n\n\nFor details about the software used, see bottom of report.\n\n#### Processing steps #####\n\nLoad necessary libraries needed by the code below\n```{r libraries,return=\"hide\"}\nlibrary(plyr) # mutate function\nlibrary(XML)  # parse HTML helper table\nlibrary(lubridate) #parse character sings to datetype\nlibrary(ggplot2)  #plots\nlibrary(Hmisc)   #contents() function, a better summary() function. can also use this to assign labels to data frame columns\n```\n\nSet working directory. Data files and pdf files containing documentations are stored in a subdirectory 'projectdata' inside this directory.\n```{r setwd}\nsetwd(\"/home/knut/Documents/coursera/datascience/5-reprod-research/RepData_PeerAssessment2\")\n```\nUncompress data with bunzip2, a common tool provided by most Unix operating systems. \nNormally, bzip2 will not overwrite existing output files. \n```{r uncompress}\ncmd <- 'bunzip2(\"projectdata/repdata_data_StormData.csv.bz2\")'\nsystem(cmd)\n```\n\nTry to determine how many rows there are in the data file.\n```{r find_nrows}\n\nfilename <- \"projectdata/repdata_data_StormData.csv\"\nnrow <- gsub('\\\\s\\\\S+$', \"\", system(paste(\"wc -l\", filename), intern = TRUE), perl=TRUE)\n```\nThe csv-file contains `r nrow` newlines. This is just an estimation for the rowcount, because the file might contain \"multiline strings\".\n\nSet all relevant environment variables to english, supporting modern (multibyte) character sets to make sure to read in the data correctly. \n```{r locale}\nSys.setlocale('LC_ALL', 'en_US.UTF-8')\n```\n\n\nInspect a subset of the data file. \n```{r classes}\n\n\ninitial <- read.csv(filename, na.strings=c(\"\",\"<NA>\"), quote=\"\",header=TRUE, nrows=187000,  stringsAsFactors=FALSE)\nclasses <- sapply(initial, class)\nclasses\n```\n\nThe database contains `r length(classes)` columns. Not all of these are needed, though.\n\n\nRead in data file, ignoring columns with \"NA\" values only. \nI found this by trial and error. Turn uppercase column names to lowercase column names\n\n```{r cache=TRUE}\nimportant_columns = c(\"NULL\", \"character\", rep(\"NULL\", 4), \"character\", \"character\", rep(\"NULL\", 14), \"numeric\", \"numeric\", \"numeric\", \"character\", \"numeric\", \"character\", rep(\"NULL\", 3), \"numeric\", \"numeric\", rep(\"NULL\", 3), \"numeric\")\nstorms <- read.csv(filename,colClasses=important_columns)\nnames(storms) <- tolower(names(storms))\ncontents(storms)\n\n\n```\n\nNumber of NULL values  is 0 for 11 out of 12 columns, except for the nonessential \"latitude\" column.\n\n\nFix NAPA valley flood 115 Billion error/outlier (B miscoded as M)\nSource: [http://pubs.usgs.gov/of/2006/1182/pdf/ofr2006-1182.pdf](http://pubs.usgs.gov/of/2006/1182/pdf/ofr2006-1182.pdf)  \nThe abstract claims total damage of $300M. Indeed, it looks like the \"B\" should have been an \"M\".\n\n```{r}\nstorms$propdmgexp[storms$refnum == 605943] <- \"M\"\n```\n\nConverting the \"date\" column to Date datatype, ignoring time zones and time of day\n```{r datetime}\nstorms$datetime <- parse_date_time(gsub('\\\\s\\\\S+$', \"\", storms$bgn_date, perl=TRUE), \"%m/%d/%Y\", truncated=3)\n```\n\n\n\n\n\n\n### Results ###\n\n\n\n\nAcross the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?\n\nThis can be answered by determining the number of fatalities by year\n```{r plot1}\nwith(storms, qplot(year(datetime), fatalities, data=storms, geom=\"bar\", xlab=\"year\", stat=\"identity\"))\n```\n\nThe plot indicates that there is a notable increase of fatalaties after 1993. This could be caused by more severe weather, or it could representa a systematic issue. The event classification scheme  \nI'll introduce an artificial grouping variable to show a quantitative view on the data:\n```{r xtab1}\nstorms$period <- ifelse(year(storms$datetime) >= 1993, \"postincl1993\", \"pre1993\")\n\n        xtabs(fatalities ~period, data=storms)\n\n```\n\n\nThis shows that the number of fatalities is being classified ina much more fine-grained manner since 1993:\n```{r xtab2}\nxtabs(fatalities ~evtype + period, data=storms[storms$fatalities > 3,])\n\n```\n\n\n#### Across the United States, determine the economic consequences ####\n**Determine total amount of economic damage by year**\nIn the database, the damage-amount is encoded as \"K\" for thousands of dollars, \"M\" as millions of dollars.\n```{r damage1}\n\nstorms$damageprop <- ifelse(storms$propdmgexp == \"M\", storms$propdmg *1000000, ifelse(storms$propdmgexp == \"K\",storms$propdmg *1000, 0))\nstorms$damagecrop <- ifelse(storms$cropdmgexp == \"M\", storms$cropdmg *1000000, ifelse(storms$cropdmgexp == \"K\",storms$cropdmg *1000, 0))\nstorms$damage <-storms$damagecrop + storms$damageprop\n```\n\nPlotting this yields this plot:  \n```{r plot2}\nwith(storms, qplot(year(datetime), storms$damageprop+ storms$damagecrop, data=storms, geom=\"bar\", xlab=\"year\", stat=\"identity\",ylab=\"Damage to crops and property, in US Dollars \"))\n\n```\n\n\nThis table lists the event types, and the damage done for each event type, for each period (post-1993 and pre-1993), in US Dollars (column \"Freq\"):\n```{r damagetable}\nstorms$damage <- storms$damagecrop + storms$damageprop\ndamage <- as.data.frame(xtabs(storms$damage ~ evtype + period, data=storms))\n\ndamage[damage$Freq > 1000000000,]\n```\n\n\nIn the 20-year period from 1993 to 2011, *each* of these event types contribute as much as the tornado-related damages that occured during the 40 year period of 1953 to 1993.  \n\n\n### Background ###\n\n\nThis document was prepared for the Coursera.com class\n*Reproducible Research:*   \n*Peer Assessment 2*  \n\nThe instructions for this  assignment can be found on this page: \n[https://github.com/rdpeng/RepData_PeerAssessment1](https://github.com/rdpeng/RepData_PeerAssessment1).  \nPlease read this first for context and details.\n\n\n\n\nKnut Behrends  \nknb@gfz-potsdam.de  \nJuly 2014  \n``` {r sessionInfo}\n\nsessionInfo()\n```",
    "created" : 1414009182668.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1114590310",
    "id" : "AE35A502",
    "lastKnownWriteTime" : 1406503785,
    "path" : "~/Documents/coursera/datascience/5-reprod-research/RepData_PeerAssessment2/stormdatabase.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}